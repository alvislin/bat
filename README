Introduction
============

BAT is a small tool to help with automation testing for audio drivers.
BAT can also mean a small flying mammal with big ears and good hearing OR Basic 
Audio Tester OR Basic ALSA Tester. Take your pick.


Install
=======

BAT can be installed by running :-

./autogen.sh
./configure
make
make install


Usage
=====

BAT is intended to analyse audio recorded in loopback mode for quality and gain
errors by comparing the captured audio PCM data to the original PCM data.

BAT should be used as this :

- To play a sinus wav file sampled at 44100Hz on one channel with 16bits per sample, record it for 88200 frames (2s) and find the main harmonic at 1000Hz
    bat -D plughw:0,0 -r 44100 -c 1 -s 2 -n 88200 -F 1000 -f file.wav
  
- To test analysis part of BAT. Play file.wav sampled at 441000Hz on one channel with 16bits per sample, and verify main harmonic of file.wav is at 1000Hz
	bat -r 44100 -c 1 -s 2 -n 88200 -F 1000 -f file.wav -l
	
- To generate internally a sinusoide sampled a 44100Hz on one channel, record it for 88200 frames and find the main harmonic at 1000Hz
    bat -D plughw:0,0 -r 44100 -c 1 -n 88200 -F 1000

Where D is pcm device number, r is sample rate of input file, c is number of channels, s is frame size in bytes, 
n is number of frames to be analysed, f is input file and F is target frequency.
Normally input is a sinus and target frequency is the frequency of the sinus.
You need to connect playback to capture through an audio jack cable. 
BAT will capture the playback of the input file and do a FFT to determine fundamental frequency of the input.
BAT will return a negative result on any errors and 0 if fundamental frequency found is one specified in F argument.

It can also be used to generate a continuous sine wave.

- to play endlessly a sinus wave at 44100Hz on one channel with 16bits per sample.
	bat -D plughw:0,0 -r 44100 -c 1 -s 2 -n 0  


Limitations
=====
- Input file length must be greater than 1s + number of frames.
- Sinusoid generation is currently limited to 1 channel with a frame size of 2 bytes.
- Input and output gain should be correctly set. Better is to use alsamixer to set 0dB gain for both input and output, otherwise you may have
distortions during recording and it may lead to non detection of main harmonic. 


Future Plans
============

1) Support other sample rates and channels.

2) Add Sine wave generator.

3) Detect gain changes, i.e. compare max signal against expected max.

4) Test driver loopback stream latency i.e mesure the time it takes to receive
   samples after playing them.




